{
  "kind": "build_request",
  "title": "Remove 'Unauthorized' trap when an already-registered user attempts to register again",
  "projectName": "Caffeine Chat",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the backend `register` method to no longer throw/trap with the message `Unauthorized: Already registered users cannot register again` when the caller is not a guest. Instead, handle this case without trapping (e.g., return `null` from `register`) so the frontend can show a normal 'already registered' message.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages-3"
        ],
        "quotes": [
          "Unauthorized: Already registered users cannot register again\nremove this feature"
        ]
      },
      "acceptanceCriteria": [
        "Calling `register` as a non-guest does not trap with `Unauthorized: Already registered users cannot register again`.",
        "`register` returns a normal response (`null` or a valid `Session`) and does not crash the canister for this scenario."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the frontend registration error handling so that when a user who is already registered tries to sign up again, the UI shows the existing friendly message `This account is already registered. Please sign in instead.` (and not the raw backend trap text).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-3"
        ],
        "quotes": [
          "Unauthorized: Already registered users cannot register again\nremove this feature"
        ]
      },
      "acceptanceCriteria": [
        "When the backend indicates a re-registration attempt by an already-registered user (via `null` return or an error message containing `Unauthorized: Already registered users cannot register again`), the UI displays `AUTH_MESSAGES.ALREADY_REGISTERED`.",
        "The raw text `Unauthorized: Already registered users cannot register again` is not shown to the user anywhere in the Sign Up flow."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo`.",
    "Do not modify any files under `frontend/src/components/ui` or the immutable hook/provider paths listed in SYSTEM_CONTEXT."
  ],
  "nonGoals": [
    "Adding new authentication providers (only existing auth approach remains).",
    "Changing the overall login/registration UI layout beyond what is necessary to remove the unwanted error behavior."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}