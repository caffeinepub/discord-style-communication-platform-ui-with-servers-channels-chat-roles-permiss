{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Caffeine Chat â€“ Fix misleading sign-up error messaging for notAGuest",
  "requirements": [
    {
      "id": "REQ-4",
      "summary": "Update frontend registration error mapping so the UI message matches the real cause when registration is blocked because the caller is not a guest (signed in / not eligible), and only claims an existing registration when the backend explicitly indicates it.",
      "acceptanceCriteria": [
        "If the backend returns the notAGuest registration error, the UI shows an English message that indicates the user is already signed in (or otherwise not eligible to register) and what to do next.",
        "No user-facing text claims an account is registered unless the backend condition truly reflects an existing registration for that principal."
      ],
      "file_operations": [
        {
          "path": "frontend/src/auth/authMessages.ts",
          "operation": "modify",
          "description": "Adjust AUTH_MESSAGES and mapRegistrationError() so that legacy/backend 'notAGuest' is mapped to a new user-facing message explaining the user is already signed in / not eligible to register (with next steps like signing out or using Sign In), and ensure 'alreadyRegistered' (when present) maps to the existing ALREADY_REGISTERED message. Update getErrorFlow()/allowlist implications accordingly so the new message is displayed in the sign-up flow."
        },
        {
          "path": "frontend/src/auth/AuthProvider.tsx",
          "operation": "modify",
          "description": "Verify registration error handling continues to surface the mapped/allowlisted message from mapRegistrationError() (including the updated notAGuest message) without being sanitized into a generic fallback, ensuring the corrected text reaches the UI."
        }
      ]
    }
  ]
}